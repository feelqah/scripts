import xml.etree.ElementTree as ET
import base64

# Load and parse the XML file
tree = ET.parse("traffic.xml")
root = tree.getroot()

# Iterate over all <item> elements
for item in root.findall("item"):
    request_elem = item.find("request")

    if request_elem is None:
        continue

    # Check if request is base64-encoded
    if request_elem.attrib.get("base64") == "true":
        # Get the base64 text (CDATA is handled automatically)
        encoded_request = request_elem.text.strip()

        # Decode base64 -> bytes -> string
        decoded_request = base64.b64decode(encoded_request).decode("utf-8", errors="replace")

        print("----- Decoded Request -----")
        print(decoded_request)
        print("---------------------------\n")

